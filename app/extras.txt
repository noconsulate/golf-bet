 ** postgresql RCP **
 
 -- insert new match
-- insert new score with match.id
create or replace function new_match(
  players integer,
  points integer,
  is_18_holes boolean,
  is_classic_scoring boolean,
  creator uuid,
  
  out match_id int,
  out score_id_1 int,
  out score_id_2 int,
  out score_id_3 int,
  out score_id_4 int

)
-- returns integer
language plpgsql
as $$
declare
  match_id_ret integer;
  score_id_1_ret int;
  score_id_2_ret int;
  score_id_3_ret int;
  score_id_4_ret int;
begin
  insert into match(players, points, is_18_holes, is_classic_scoring, creator, players_joined)
  values(players, points, is_18_holes, is_classic_scoring, creator, 1)
  returning id into match_id_ret;

  match_id = match_id_ret;

  -- create rows in score_x for each player
  if is_18_holes = false then

    insert into score_9(match_id, player)
    values(match_id, 1)
    returning id into score_id_1_ret;
    score_id_1 = score_id_1_ret;

    if players > 1 then
      insert into score_9(match_id, player)
      values(match_id, 2)
      returning id into score_id_2_ret;
      score_id_2 = score_id_2_ret;
    end if;

    if players > 2 then
      insert into score_9(match_id, player)
      values(match_id, 3)
      returning id into score_id_3_ret;
      score_id_3 = score_id_3_ret;
    end if;

    if players > 3 then
      insert into score_9(match_id, player)
      values(match_id, 4)
      returning id into score_id_4_ret;
      score_id_4 = score_id_4_ret;
    end if;

  else 
  
    insert into score_18(match_id, player)
    values(match_id, 1)
    returning id into score_id_1_ret;
    score_id_1 = score_id_1_ret;

    if players > 1 then
      insert into score_18(match_id, player)
      values(match_id, 2)
      returning id into score_id_2_ret;
      score_id_2 = score_id_2_ret;
    end if;

    if players > 2 then
      insert into score_18(match_id, player)
      values(match_id, 3)
      returning id into score_id_3_ret;
      score_id_3 = score_id_3_ret;
    end if;

    if players > 3 then
      insert into score_18(match_id, player)
      values(match_id, 4)
      returning id into score_id_4_ret;
      score_id_4 = score_id_4_ret;
    end if;

  end if;

end; $$;